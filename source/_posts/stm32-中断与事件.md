---
title: stm32 中断与事件
date: 2025-12-24 23:14:54
categories: [学习笔记, 嵌入式, MCU] 
tags: [嵌入式, mcu, stm32]
---
# stm32中断和事件

## 定义

中断和事件是两个东西

中断是指的，cpu的中断控制器在收到中断请求后，停止当前任务，转去处理中断事件，运行中断处理函数，根据IVT中定义的函数策略，都是WEAK定义，你可以自己覆写。

事件则指的，外部的输入信号，不输入NVIC， 直接到脉冲产生模块，从而产生一个脉冲事件，这个脉冲信号会发给你想要发给的设备。

![alt text](../images/11.1.png)

![alt text](../images/11.2.png)

## 中断产生流程
1. 外设输入端gpio产生信号（比如下降沿，上升沿）
2. EXTI起到路由的作用，
   1. 既可以产生软件中断（内部设置软件中断寄存器把或门置1），
   2. 也可以产生硬件中断（判定上升沿触发，边沿检测输出1,自动把请求挂起寄存器置1,之后只要把中断屏蔽寄存器置1开中断即可让NVIC产生中断，NVIC会通知CM3内核去按照IVT执行相应的中断处理函数）
   3. 产生事件（脉冲信号，直接发给其他的设备）
3. NVIC接收到中断请求，开始通知CM3产生中断
4. CM3保存当前堆栈，然后跳转到IVT指定的中断处理函数。
5. EXTI4_IRQHandler中断处理函数内，清除挂起位，表面CM3已经知道并且正在处理此中断，并调用对应的回调函数来处理中断。处理完之后，再次清中断，防止多次处理。
6. CM3恢复现场
   

## NVIC
CM3内核内部的模块，具体定义在ARM中。
帮助设置所有中断的优先级组，同时设置一个中断的抢占式优先级和子优先级。

## EXTI
可以看成是一个输入信号的路由模块，把我们输入的输入信号，帮助NVIC判断是什么方式触发，是想要软件触发还是外部硬件触发，是想要触发中断还是触发事件。

## 实现流程思路
总共设置4个部分
输入gpio --> EXTI --> NVIC --> 输出GPIO

NVIC部分：
1. 设置优先级组
2. 设置抢占式优先级和子优先级
3. 使能NVIC
4. 找到IVT对应的想要的中断处理函数入口名称

EXTI：
1. 设置下降沿触发
2. 关闭软件中断（可有可无）
3. 开中断（IMR）

GPIO输入：
1. 设置gpio相关
2. 与EXTI绑定

（hal_gpio库中，已经将输入GPIO和EXTI合并，可以直接像设置gpio一样选择AFIO复用EXTI输入）

GPIO输出：
1. 重写回调函数，gpio中断的回调函数，hal库中已经写好了weak定义。